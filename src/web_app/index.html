<!DOCTYPE html>
<html lang="ko">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />
  <meta name="theme-color" content="#62f0b8" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta name="apple-mobile-web-app-title" content="Study Helper" />
  <meta name="description" content="Study Helper - ì½”ë“œ/ë¬¸ì œ ì—°ìŠµì‹¤" />
  <title>Study Helper | ì½”ë“œ/ë¬¸ì œ ì—°ìŠµì‹¤</title>
  <link rel="manifest" href="manifest.json" />
  <link rel="apple-touch-icon" href="icon-192.png" />
  <!-- CSS with cache busting -->
  <link rel="stylesheet" href="style.css" id="main-style" />
  <script>
    // Force cache clear on every load
    (function () {
      var ts = new Date().getTime();
      var style = document.getElementById('main-style');
      if (style) style.href = 'style.css?v=' + ts;

      // Clear service worker cache
      if ('caches' in window) {
        caches.keys().then(function (names) {
          names.forEach(function (name) { caches.delete(name); });
        });
      }

      // Unregister service workers
      if ('serviceWorker' in navigator) {
        navigator.serviceWorker.getRegistrations().then(function (registrations) {
          registrations.forEach(function (registration) {
            registration.unregister();
          });
        });
      }
    })();
  </script>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@400;600;700&family=JetBrains+Mono:wght@400;600&family=Pretendard:wght@400;600;700&display=swap"
    rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/atom-one-dark.min.css">
</head>

<body>
  <header>
    <div class="brand">
      <div class="brand-logo">SH</div>
      <div>
        <div class="brand-name">Study Helper</div>
        <div class="brand-sub">ì½”ë“œ/ë¬¸ì œ ì—°ìŠµì‹¤</div>
      </div>
    </div>
    <div class="actions">
      <span id="ngrok-url" class="ngrok-url" style="display:none" title="í´ë¦­í•˜ë©´ ë³µì‚¬">ì™¸ë¶€ ì£¼ì†Œ: ë¡œë”©ì¤‘...</span>
      <span id="mobile-url" class="mobile-url" title="í´ë¦­í•˜ë©´ ë³µì‚¬">ëª¨ë°”ì¼ ì ‘ì†: ë¡œë”©ì¤‘...</span>
      <span id="study-timer" class="study-timer" title="ê³µë¶€ ì‹œê°„">â±ï¸ 00:00</span>
      <button id="btn-file-mode" class="primary-btn" title="íŒŒì¼/ëª¨ë“œ ì„ íƒ (F)">ğŸ“‚ íŒŒì¼/ëª¨ë“œ</button>
      <button id="btn-shuffle" class="shuffle-btn" title="ë¬¸í•­ ìˆœì„œ ì„ê¸° (S)">ğŸ”€ ìˆœì„œ ì„ê¸°</button>
      <button id="btn-api-key" class="api-btn" title="Gemini API í‚¤ ì„¤ì •">ğŸ”‘ API</button>
      <button id="btn-shutdown" class="danger-btn" title="ì„œë²„ ì¢…ë£Œ">â»</button>
    </div>
  </header>

  <main class="layout">
    <section class="info">
      <div class="card">
        <div class="label">ì œëª©</div>
        <div id="session-title" class="value">ì„¸ì…˜ì„ ë¶ˆëŸ¬ì£¼ì„¸ìš”</div>
      </div>
      <div class="card">
        <div class="label">ì–¸ì–´</div>
        <div id="session-lang" class="value">-</div>
      </div>
      <div class="card">
        <div class="label">ëª¨ë“œ</div>
        <div id="session-mode" class="value">-</div>
      </div>
      <div class="card">
        <div class="label">ë¹ˆì¹¸</div>
        <div id="session-count" class="value">0</div>
      </div>
      <div class="card">
        <div class="label">ì ìˆ˜</div>
        <div id="session-score" class="value">0 / 0</div>
        <div id="session-progress" class="progress-bar"><span style="width:0%"></span></div>
      </div>
    </section>

    <section class="controls">
      <div class="controls-left">
        <span id="streak-counter" class="streak-badge" style="display:none">ğŸ”¥ 0</span>
        <span class="badge">Enter: ë‹¨ë‹µ ì…ë ¥ + ìë™ ì´ë™</span>
        <span class="hint emphasis">Ctrl+Enter ì „ì²´ ì±„ì  / Shift+Enter ê°œë³„ í™•ì¸(Mode3)</span>
        <span id="review-badge" class="hint emphasis">ë³µìŠµ 0</span>
      </div>
      <div class="controls-right">
        <button id="btn-reveal" title="ì •ë‹µ ë³´ê¸° (V)">ğŸ§  ì •ë‹µ</button>
        <button id="btn-regenerate" class="regen-btn" title="ë¬´ì‘ìœ„ ë¹ˆì¹¸ ì¬ìƒì„±">â™»ï¸ ìƒˆë¡œ</button>
        <button id="btn-toggle-completed" class="ghost-btn" title="ì™„ë£Œ ì¹´ë“œ ìˆ¨ê¸°ê¸°">ì™„ë£Œ ìˆ¨ê¸°ê¸°</button>
        <button id="btn-review" title="í‹€ë¦°/ë¯¸ë‹µë§Œ ë³µìŠµ">ğŸ“Œ ë³µìŠµ</button>
        <button id="btn-reset" title="ëª¨ë“  ì…ë ¥ ì´ˆê¸°í™” (R)">ğŸ§¹ ë¦¬ì…‹</button>
      </div>
    </section>

    <section class="workspace">
      <aside class="blank-nav" id="blank-nav">
        <div class="nav-header">
          <div class="nav-title">ë¹ˆì¹¸ ëª©ë¡</div>
          <button id="btn-toggle-nav" class="toggle-nav-btn" title="ëª©ë¡ ë‹«ê¸°">ëª©ë¡</button>
        </div>
        <div class="nav-sub">ìƒíƒœ: â–« ë¯¸ë‹µ / ğŸŸ¢ ì •ë‹µ / ğŸŸ  ì‹œë„ / ğŸ”´ í‹€ë¦¼</div>
        <div id="blank-list" class="blank-list"></div>
      </aside>
      <button id="btn-show-nav" class="show-nav-btn" title="ë¹ˆì¹¸ ëª©ë¡ ë³´ê¸°">ëª©ë¡ ë³´ê¸°</button>

      <section class="code-shell">
        <div class="toolbar">
          <div class="toolbar-left">
            <span class="badge">ë¬¸ì œ ì½”ë“œ</span>
            <span class="hint">ìë™ ë²ˆí˜¸ ë§¤ê¸°ê¸° + ì½”ë“œ ë³µì‚¬</span>
          </div>
          <div class="toolbar-right">
            <span class="hint">Ctrl+L: AI íŒ¨ë„</span>
          </div>
        </div>
        <div id="code-area" class="code-area"></div>
      </section>
    </section>

    <section class="answer-panel">
      <details>
        <summary>ì •ë‹µ ì½”ë“œ/í•´ì„¤ ë³´ê¸°</summary>
        <pre id="answer-block" class="answer-block"></pre>
      </details>
    </section>
  </main>

  <!-- ì„ íƒ ì½”ë“œ ì„¤ëª… ë²„íŠ¼ -->
  <div id="floating-explain" class="floating-explain" style="display:none;">
    <button id="btn-explain-selection">ì„ íƒ ì½”ë“œ ì„¤ëª… ë“£ê¸°</button>
  </div>

  <!-- AI ì‚¬ì´ë“œ íŒ¨ë„ -->
  <aside id="ai-panel" class="ai-panel">
    <div class="ai-panel-header">
      <h3>ğŸ’¬ AI ì±„íŒ…</h3>
      <div class="ai-panel-header-btns">
        <button id="btn-ai-new" class="icon-btn" title="ìƒˆ ëŒ€í™”">â•</button>
        <button id="btn-ai-history" class="icon-btn" title="íˆìŠ¤í† ë¦¬">ğŸ•’</button>
        <button id="btn-close-panel" class="icon-btn" title="ë‹«ê¸°">âœ–</button>
      </div>
    </div>

    <!-- ë¦¬ì‚¬ì´ì¦ˆ í•¸ë“¤ -->
    <div class="ai-panel-resize-handle" id="ai-panel-resize"></div>

    <div class="ai-panel-content">
      <div class="chat-messages-wrapper">
        <div id="chat-messages" class="chat-messages"></div>
      </div>
      <div class="chat-input-area">
        <textarea id="chat-input" placeholder="ì§ˆë¬¸ì„ ì…ë ¥í•˜ì„¸ìš”... (Enter=ì „ì†¡)"></textarea>
        <button id="btn-send-chat" class="chat-send-btn">ì „ì†¡</button>
      </div>
    </div>
  </aside>

  <!-- API í‚¤ ëª¨ë‹¬ -->
  <div id="api-key-modal" class="modal" style="display:none;">
    <div class="modal-content">
      <h3>ğŸ”‘ Gemini API í‚¤ ì„¤ì •</h3>
      <p>AI ê¸°ëŠ¥ì„ ì‚¬ìš©í•˜ë ¤ë©´ Google Gemini API í‚¤ê°€ í•„ìš”í•©ë‹ˆë‹¤.</p>
      <input type="password" id="api-key-input" placeholder="API í‚¤ë¥¼ ì…ë ¥í•˜ì„¸ìš”" />
      <div class="modal-actions">
        <button id="btn-save-api-key">ì €ì¥</button>
        <button id="btn-cancel-api-key">ì·¨ì†Œ</button>
      </div>
      <p class="hint">í‚¤ëŠ” ë¸Œë¼ìš°ì €/ë¡œì»¬ì—ë§Œ ì €ì¥ë˜ê³ , ë„ë©´ ë¡œì»¬ ëª¨ë“œë¡œë§Œ ë™ì‘í•©ë‹ˆë‹¤.</p>
    </div>
  </div>

  <!-- ë¹ˆì¹¸ ì¬ìƒì„± ëª¨ë‹¬ -->
  <div id="regenerate-modal" class="modal" style="display:none;">
    <div class="modal-content">
      <h3>ğŸ”„ ë¬´ì‘ìœ„ ë¹ˆì¹¸ ìƒì„±</h3>
      <p>ìƒì„±í•  ë¹ˆì¹¸ì˜ ê°œìˆ˜ë¥¼ ì…ë ¥í•˜ì„¸ìš” (10~100)</p>
      <input type="number" id="regen-count-input" value="50" min="10" max="100" />
      <div class="modal-actions">
        <button id="btn-confirm-regen">ì¬ìƒì„±</button>
        <button id="btn-cancel-regen">ì·¨ì†Œ</button>
      </div>
    </div>
  </div>

  <!-- íŒŒì¼/ëª¨ë“œ ì„ íƒ ëª¨ë‹¬ -->
  <div id="file-mode-modal" class="modal" style="display:none;">
    <div class="modal-content file-mode-modal">
      <h3>ğŸ“‚ ê¸°ë³¸ íŒŒì¼ &amp; ëª¨ë“œ ì„ íƒ</h3>

      <div class="fm-section">
        <label>ê¸°ë³¸ íŒŒì¼ ì„ íƒ</label>
        <div class="fm-presets" id="preset-buttons">
          <button class="fm-preset" data-preset="oop_vocab" data-default-mode="7">1) OOP ì˜ë‹¨ì–´</button>
          <button class="fm-preset" data-preset="oop_concept" data-default-mode="5">2) OOP ê°œë…ì–´</button>
          <button class="fm-preset" data-preset="oop_code" data-default-mode="1">3) OOP ì½”ë“œ ë¹ˆì¹¸</button>
          <button class="fm-preset" data-preset="data_structure" data-default-mode="3">4) ìë£Œêµ¬ì¡° ì½”ë“œ</button>
          <button class="fm-preset" data-preset="math_theory" data-default-mode="4">5) ì „ì‚°ìˆ˜í•™ í•„ê¸°</button>
          <button class="fm-preset" data-preset="math_practice" data-default-mode="6">6) ì „ì‚°ìˆ˜í•™ ì‹¤ê¸°</button>
          <label class="fm-preset fm-upload">
            <input type="file" id="custom-file-input" accept=".txt,.py,.c,.cpp,.java,.js,.cs" style="display:none" />
            ì§ì ‘ íŒŒì¼ ì„ íƒ
          </label>
        </div>
        <p class="fm-selected">ì„ íƒëœ íŒŒì¼: <span id="selected-file-name">1_OOP_Vocabulary.txt</span></p>
      </div>

      <div class="fm-section">
        <label>ëª¨ë“œ ì„ íƒ</label>
        <div class="fm-modes" id="mode-buttons">
          <button class="fm-mode" data-mode="1">1. OOP ë¹ˆì¹¸ ì±„ìš°ê¸°</button>
          <button class="fm-mode" data-mode="2">2. ìë£Œêµ¬ì¡° ë¹ˆì¹¸</button>
          <button class="fm-mode active" data-mode="3">3. ë°±ì§€ ì—°ìŠµ</button>
          <button class="fm-mode" data-mode="4">4. ëª¨ì˜ê³ ì‚¬</button>
          <button class="fm-mode" data-mode="5">5. ì •ì˜ í€´ì¦ˆ</button>
          <button class="fm-mode" data-mode="6">6. ì½”ë“œ ì‘ì„±(ì „ì‚°ìˆ˜í•™)</button>
          <button class="fm-mode" data-mode="7">7. ì˜ë‹¨ì–´ í›ˆë ¨</button>
        </div>
      </div>

      <div class="fm-section" id="difficulty-section" style="display:none;">
        <label>ğŸ¯ ë‚œì´ë„ ì„ íƒ <span class="fm-hint">(Mode 1, 2 ì „ìš©)</span></label>
        <div class="fm-difficulty" id="difficulty-buttons">
          <button class="fm-diff" data-diff="easy">ğŸ˜Š ì‰¬ì›€</button>
          <button class="fm-diff active" data-diff="normal">ğŸ“ ë³´í†µ</button>
          <button class="fm-diff" data-diff="hard">ğŸ”¥ ì–´ë ¤ì›€</button>
          <button class="fm-diff" data-diff="extreme">ğŸ’€ ë§¤ìš°ì–´ë ¤ì›€</button>
        </div>
        <p class="fm-diff-hint" id="diff-hint">ë³´í†µ: ì£¼ì„ 30% + ì½”ë“œ 40% ë¹ˆì¹¸</p>
      </div>

      <div class="fm-section">
        <label>ë¬¸ì œ ìƒì„± ë°©ì‹</label>
        <div class="fm-methods" id="method-buttons">
          <button class="fm-method active" data-method="local">âš¡ ë¡œì»¬ (ë¹ ë¦„)</button>
          <button class="fm-method" data-method="ai">âœ¨ AI (Gemini)</button>
        </div>
        <p class="fm-method-hint">ë¡œì»¬: ì¦‰ì‹œ ìƒì„±, AI: Gemini APIë¡œ ë³€í˜•/ì¶”ê°€ ë¬¸ì œ ìƒì„±</p>
      </div>

      <div class="modal-actions">
        <button id="btn-generate-session" class="primary">ğŸš€ ì„¸ì…˜ ìƒì„±</button>
        <button id="btn-cancel-fm">ì·¨ì†Œ</button>
      </div>

      <p id="fm-status" class="fm-status"></p>
      <div id="ai-progress-container" class="progress-bar-container" style="display:none; margin-top: 10px;">
        <div class="progress-bar-fill" id="ai-progress-fill" style="width: 0%"></div>
      </div>
      <p id="ai-progress-text"
        style="display:none; text-align: center; font-size: 12px; color: var(--muted); margin-top: 5px;">0%</p>
    </div>
  </div>

  <!-- ëª¨ë“œë³„ í”Œë¡œíŒ… ë²„íŠ¼ -->
  <button id="btn-ai-toggle" class="floating-ai-toggle">AI</button>
  <button id="btn-scroll-top" class="floating-top">ë§¨ ìœ„ë¡œ</button>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
  <script>
    const script = document.createElement('script');
    script.src = 'app.js?v=' + new Date().getTime();
    document.body.appendChild(script);

    window.addEventListener('unload', function () {
      if (navigator.serviceWorker && navigator.serviceWorker.controller) {
        navigator.serviceWorker.controller.postMessage('CLEAR_CACHE');
      }
      try {
        localStorage.removeItem('quiz_session_progress');
      } catch (e) { }
    });
  </script>
</body>

</html>